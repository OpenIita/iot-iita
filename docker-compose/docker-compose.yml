version: '1'
services:
  redis:
    image: redis:latest
    container_name: iotkit-ce-redis
    ports:
      - 6379:6379
    command: redis-server --appendonly yes
  elasticsearch:
    image: elasticsearch:7.12.0
    container_name: iotkit-ce-elasticsearch
    environment:
      ES_JAVA_OPTS: -Djava.net.preferIPv4Stack=true -Xms1g -Xmx1g
      transport.host: 0.0.0.0
      discovery.type: single-node
      bootstrap.memory_lock: "true"
    ports:
      - 9200:9200
      - 9300:9300
  ui:
    image: uncleregan/iotkit-ui:0.3.4
    container_name: iotkit-ce-ui
    ports:
      - 80:80
    links:
      - iotkit:iotkit
  iotkit:
    image: uncleregan/iotkit:0.3.3
    container_name: iotkit-cei
    restart: on-failure
    ports:
      - 8086:8086 # API端口
      - 1883-1890:1883-1890 # 预留
      - 8000-8010:8000-8010 # 预留
    links:
      - redis:redis
      - elasticsearch:elasticsearch
    depends_on:
      - elasticsearch
      - redis